<!DOCTYPE HTML>
<!-- template for HTML conversion plot -->
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> iNZight Plot </title>
      <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.min.css">
<style> /* layout settings */
#main {
  position: fixed;
  display: flex;
  width: 100%;
  top: 60px;
  height: calc(100% - 60px);
  flex-direction: row;
  justify-content: flex-start;
  align-items: center;
  padding: 10px;
  background-color: #e3e3e3;
  overflow: hidden;
}

.svg-div, .tbl-div {
  transition: all ease-in-out 0.5s;
  padding: 20px;
  border-radius: 5px;
  height: 100%;
  background-color: white;
  box-shadow: 0 0 3px #B0BEC5;
  min-width: 50%;
}

.tbl-div {
   overflow-x: auto;
}

/*moveEverything left/right */
.moveRight {
  transform: translateX(200%);
}

.moveLeft {
  transform: translateX(-200%);
}

.expand {
  min-width: 100%;
  transform: translateX(-50%);
}

.mid {
  min-width: 100%;
  /*transform: translateX(50%);*/
}

svg {
  display: inline-block;
  margin: auto;
  width: 100%;
  height: 100%;
}

/* attempt to use media queries */
@media (max-width: 600px), (orientation: portrait) {

  #main {
    position: fixed;
    width: 100%;
    flex-direction: column;
  }

  .svg-div, .tbl-div {
    transition: all ease-in-out 0.5s;
    width: 100%;
    min-height: 50%;
  }

  svg {
    height: 100%;
  }

  .tbl-div {
    overflow-y: auto;
  }

  /* move everything up/down */
  .moveRight {
    transform: translateY(200%);
  }

  .moveLeft {
    transform: translateY(-200%);
  }

  .mid {
    min-height: 100%;
    /*transform: translateY(50%);*/
  }

  .expand {
    min-height: 100%;
    transform: translateY(-50%);
  }

  label {
    display: none;
  }

}

/* navigation bar */
#control {
  width: 100%;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  height: 60px;
  background-color: #12508a;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
}

.menu {
  list-style: none;
  display: flex;
  flex-direction: row;
  justify-content: space-around;
  align-items: center;
  margin: 0;
  padding: 0;
}

.menu li {
  color: rgba(255, 255, 255, 0.8);
  text-align: right;
  font-size: 15px;
  margin: 5px;
  transition: all ease 0.3s;
  padding: 7px;
  border-radius: 3px;
}

.menu li:hover {
  color: rgba(255, 255, 255, 1);
}

.glyphicon {
  font-size: 15px;
}

#selectVar {
  height: 45px;
}

.form-div {
  margin: 15px 0px;
}

label {
  color: rgba(255, 255, 255, 0.8);
  margin-right: 5px;
  font-weight: normal;
}

/* style help overlay */
.help-overlay {
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  position: fixed;
  top: 60px;
  left: 0;
  bottom: 0;
  right: 0;
  background-color: rgba(0,0,0,0.5);
  z-index: -1;
  transition: all ease 0.5s;
  overflow-y: auto;
}

.help-info {
  padding: 10px;
  margin: auto;
  color: black;
  background-color: white;
  border-radius: 5px;
  text-align: center;
}

.title {
  font-size: 25px;
}

.move {
  opacity: 1;
  z-index: 5;
}

.logo {
  width: 20%;
}

/*** TABLE PROPERTIES ***/
/*totals column  or totals row */
table {
  width: 100% !important;
}

td, th {
  text-align: center;
  word-wrap: break-word;
  font-size: 12px;
}

/* table headings */
.headings {
  font-style: italic;
  font-weight:normal;
  text-decoration: underline;
  text-align: center;
  align: center;
}

/* groups for two way bar plots */
.yGroup, .tc {
  text-align: center;
  font-weight: bold;
}

.Percentage {
  background-color:rgb(0, 0, 255);
  color: white;
  opacity: 0.75;
  margin-left: 10px;
}

.Count {
 background-color: purple;
 opacity: 0.75;
 color: white;
 margin-left: 10px;
}

.trend-info, .brush-info {
  color: white;
}

/* textlabels */
.label {
  font-size: 10;
  fill: black;
  stroke: none;
  fill-opacity: 1;
  text-anchor: middle;
  visibility: inherit;
  font-weight: normal;
}

/* BAR PROPERTIES (for bar charts) */
.bar {
  stroke: none;
  visibility: visible;
  opacity: 1;
}

.bar:hover {
  stroke-width: 50%;
  fill-opacity: 0.5;
}

/* upon selection */
.selected {
  opacity: 1;
  visibility: visible;
}

.none {
  opacity: 0.2;
}

.hidden {
  display: none;
  visibility: hidden;
}

/*highlighting data */
.totalRow, .tabSelect, .select {
  align: center;
  font-weight: bold;
}

.rowSelect {
  display: table-row;
  opacity: 1;
}

/* legend interactions and styling */
.show {
  font-size: 115%;
  fill-opacity: 0.5;
}

.out {
  font-size: 100%;
  fill-opacity: 1;
}

.keyText {
  fill: black;
}

/* for box plots - dot plots, histograms */
.box {
  fill: gray;
  fill-opacity: 0.5;
}

.fillBox {
  fill-opacity: 0.2;
}

/* for dot plots and scatter plots */
.point:hover { /* showPoint */
  fill: currentColor;
  stroke-width: 50%;
  fill-opacity: 1;
}

/* for histograms and hexbins */
.histBar {
  stroke: white;
  stroke-width: 0.25;
}

.hexbin {
  stroke: none;
}

.hexbin:hover, .histBar:hover {
  fill-opacity: 0.5;
}

div.tooltip {
    position: absolute;
    text-align: center;
    padding: 5px;
    z-index: 5;
    opacity: 1;
    visibility: hidden;
    font: 11px sans-serif;
    background: white;
    border: 1px solid lightgray;
    border-radius: 5px;
    pointer-events: none;
}

span {
  font-weight: bold;
}

/* for iNZightMaps */
.selectRegion {
  stroke: darkgray;
  fill: black;
  fill-opacity: 0.5;
}

/* line chart container */
.spark-div {
  width: 100%;
  padding: 10px;
  clear: left;
}

/* ggplot2 theme for sparkline chart */
.grid-background {
  fill: #ddd;
}

.spark-xaxis path, .spark-yaxis path {
  display: none;
}

.grid-lines {
  stroke: #fff;
  stroke-width: 0.75px;
}

.grid path {
  display: none;
}

.minor {
  stroke-opacity: 0.5;
  stroke-width: 0.5px;
}

.grid text {
  display: none;
}

/* lines on the chart */
.spark-line {
  fill: none;
  stroke: black;
  opacity: 0.2;
  stroke-width: 1.5;
}

.follow-text {
    stroke: white;
    fill: black;
    stroke-width: 0.05;
    font-size: 12px;
    text-anchor: middle;
}

.region-lab {
  font-size: 13px;
}

.x-lab, .spark-title, .main-title {
  text-anchor: middle;
}

.x-lab, .y-lab {
  font-size: 16px;
}

.main-title, .spark-title {
  fill: black;
  fill-opacity: 1;
  font-size: 18px;
}

.x-line {
  stroke: black;
  stroke-width: 0.5;
}

/* time slider */
.slider-div {
  width: 100%;
}

.slider {
  -webkit-appearance: none;
  height: 5px;
  border-radius: 5px;
  background: lightgray;
  width: calc(100% - 15px);
  display: inline-block;
}

/* circle thumb */
.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: black;
  cursor: pointer;
  transition: background 0.15s ease-in-out;
}

.slider-val {
  width: 55px;
  border-radius: 5px;
  color: rgba(255, 255, 255, 0.8);
  text-align: center;
  line-height: 12px;
  margin: auto;
}

.slider::-webkit-slider-thumb:hover {
  background: darkgray;
}

/* play-pause button */
.play-pause {
    text-align: center;
    margin: auto;
    width: 100%;
}

.group-mean-label {
  pointer-events: none;
} </style>
    <script type = "text/javascript" src = "https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type = "text/javascript" src = "https://d3js.org/d3.v4.min.js"></script>
    <script type = "text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type = "text/javascript" src ="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"> </script>
    <script type = "text/javascript" charset="utf8" src = "https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js"></script>
  </head>
  <body>
    <!-- control panel -->
    <div class = "control" id = "control">
      <ul class = "menu">
        <li class = "plot"> <span class="glyphicon glyphicon-stats"></span> Plot </li>
        <li class = "view-tbl"><span class="glyphicon glyphicon-list-alt"></span> Table </li>
        <li class = "reset" id = "reset"> <span class="glyphicon glyphicon-refresh"></span> Reset </li>
        <li class = "help"><span class = "glyphicon glyphicon-question-sign"> </span> </li>
      </ul>
    </div>
    <div id = "main">
      <div class = "svg-div">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="354px" height="369px" viewBox="0 0 354 369" version="1.1">
  <metadata xmlns:gridsvg="http://www.stat.auckland.ac.nz/~paul/R/gridSVG/">
    <gridsvg:generator name="gridSVG" version="1.7-1" time="2020-04-24 11:41:04"/>
    <gridsvg:argument name="name" value=""/>
    <gridsvg:argument name="exportCoords" value="none"/>
    <gridsvg:argument name="exportMappings" value="none"/>
    <gridsvg:argument name="exportJS" value="none"/>
    <gridsvg:argument name="res" value="96"/>
    <gridsvg:argument name="prefix" value=""/>
    <gridsvg:argument name="addClasses" value="FALSE"/>
    <gridsvg:argument name="indent" value="TRUE"/>
    <gridsvg:argument name="htmlWrapper" value="FALSE"/>
    <gridsvg:argument name="usePaths" value="vpPaths"/>
    <gridsvg:argument name="uniqueNames" value="TRUE"/>
    <gridsvg:separator name="id.sep" value="."/>
    <gridsvg:separator name="gPath.sep" value="::"/>
    <gridsvg:separator name="vpPath.sep" value="::"/>
  </metadata>
  <g transform="translate(0, 369) scale(1, -1)">
    <g id="gridSVG" fill="rgb(255,255,255)" stroke="rgb(0,0,0)" stroke-dasharray="none" stroke-width="1" font-size="16" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" opacity="1" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-opacity="1" fill-opacity="1" font-weight="normal" font-style="normal">
      <defs>
        <symbol id="gridSVG.pch22" viewBox="-5 -5 10 10" overflow="visible">
          <rect x="-3.32" y="-3.32" width="6.64" height="6.64"/>
        </symbol>
      </defs>
      <g id="container.1" font-size="16">
        <g id="container::VP:TOPlayout.1">
          <g id="container::VP:TOPlayout::GRID.VP.517.1"/>
        </g>
        <g id="container::VP:TOPlayout.2">
          <g id="container::VP:TOPlayout::GRID.VP.518.1">
            <g id="inz-main-title.1">
              <g id="inz-main-title.1.1" transform="translate(177, 354)" stroke-width="0.1">
                <g id="inz-main-title.1.1.scale" transform="scale(1, -1)">
                  <text x="0" y="0" id="inz-main-title.1.1.text" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1" font-size="19.2">
                    <tspan id="inz-main-title.1.1.tspan.1" dy="7.5" x="0">Distribution of Education.reord</tspan>
                  </text>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
      <g id="container.2" font-size="16">
        <g id="container::VP:TOPlayout.3">
          <g id="container::VP:TOPlayout::GRID.VP.519.1">
            <g id="inz-ylab.1">
              <g id="inz-ylab.1.1" transform="translate(11.52, 204.35)" stroke-width="0.1">
                <g id="inz-ylab.1.1.scale" transform="scale(1, -1)">
                  <text x="0" y="0" id="inz-ylab.1.1.text" transform="rotate(-90)" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                    <tspan id="inz-ylab.1.1.tspan.1" dy="6.5" x="0">Proportion (%)</tspan>
                  </text>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
      <g id="container.3" font-size="16">
        <g id="container::VP:TOPlayout.4">
          <g id="container::VP:TOPlayout::GRID.VP.520.1">
            <g id="inz-xlab.1">
              <g id="inz-xlab.1.1" transform="translate(116.5, 33.52)" stroke-width="0.1">
                <g id="inz-xlab.1.1.scale" transform="scale(1, -1)">
                  <text x="0" y="0" id="inz-xlab.1.1.text" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                    <tspan id="inz-xlab.1.1.tspan.1" dy="6.5" x="0">Education.reord</tspan>
                  </text>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
      <g id="container.4" font-size="16">
        <g id="container::VP:TOPlayout.5">
          <g id="container::VP:TOPlayout::GRID.VP.521.1">
            <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout.1"/>
          </g>
        </g>
      </g>
      <g id="container.5" font-size="16">
        <g id="container::VP:TOPlayout.6">
          <g id="container::VP:TOPlayout::GRID.VP.521.2">
            <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout.2">
              <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522.1">
                <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505.1">
                  <g id="inz-leg-layout.1">
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.506.1">
                      <g id="GRID.cellGrob.460.1">
                        <g id="inz-leg-title.1">
                          <g id="inz-leg-title.1.1" transform="translate(269.2, 274.15)" stroke-width="0.1">
                            <g id="inz-leg-title.1.1.scale" transform="scale(1, -1)">
                              <text x="0" y="0" id="inz-leg-title.1.1.text" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                                <tspan id="inz-leg-title.1.1.tspan.1" dy="6.5" x="0">Education.reord</tspan>
                              </text>
                            </g>
                          </g>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.507.1">
                      <g id="GRID.cellGrob.461.1">
                        <g id="inz-leg-pt-1.1">
                          <use id="inz-leg-pt-1.1.1" href="#gridSVG.pch22" x="221.2" y="238.55" width="16" height="16" transform=" translate(-8,-8)" stroke="rgb(68,1,84)" stroke-width="1.25" fill="rgb(68,1,84)" stroke-opacity="1" fill-opacity="1" font-size="16"/>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.508.1">
                      <g id="GRID.cellGrob.462.1">
                        <g id="inz-leg-txt-1.1">
                          <g id="inz-leg-txt-1.1.1" transform="translate(240.4, 238.55)" stroke-width="0.1">
                            <g id="inz-leg-txt-1.1.1.scale" transform="scale(1, -1)">
                              <text x="0" y="0" id="inz-leg-txt-1.1.1.text" text-anchor="start" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                                <tspan id="inz-leg-txt-1.1.1.tspan.1" dy="6.5" x="0">8thGrade</tspan>
                              </text>
                            </g>
                          </g>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.509.1">
                      <g id="GRID.cellGrob.463.1">
                        <g id="inz-leg-pt-2.1">
                          <use id="inz-leg-pt-2.1.1" href="#gridSVG.pch22" x="221.2" y="212.55" width="16" height="16" transform=" translate(-8,-8)" stroke="rgb(59,82,139)" stroke-width="1.25" fill="rgb(59,82,139)" stroke-opacity="1" fill-opacity="1" font-size="16"/>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.510.1">
                      <g id="GRID.cellGrob.464.1">
                        <g id="inz-leg-txt-2.1">
                          <g id="inz-leg-txt-2.1.1" transform="translate(240.4, 212.55)" stroke-width="0.1">
                            <g id="inz-leg-txt-2.1.1.scale" transform="scale(1, -1)">
                              <text x="0" y="0" id="inz-leg-txt-2.1.1.text" text-anchor="start" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                                <tspan id="inz-leg-txt-2.1.1.tspan.1" dy="6.5" x="0">9_11thGrade</tspan>
                              </text>
                            </g>
                          </g>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.511.1">
                      <g id="GRID.cellGrob.465.1">
                        <g id="inz-leg-pt-3.1">
                          <use id="inz-leg-pt-3.1.1" href="#gridSVG.pch22" x="221.2" y="186.55" width="16" height="16" transform=" translate(-8,-8)" stroke="rgb(33,144,140)" stroke-width="1.25" fill="rgb(33,144,140)" stroke-opacity="1" fill-opacity="1" font-size="16"/>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.512.1">
                      <g id="GRID.cellGrob.466.1">
                        <g id="inz-leg-txt-3.1">
                          <g id="inz-leg-txt-3.1.1" transform="translate(240.4, 186.55)" stroke-width="0.1">
                            <g id="inz-leg-txt-3.1.1.scale" transform="scale(1, -1)">
                              <text x="0" y="0" id="inz-leg-txt-3.1.1.text" text-anchor="start" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                                <tspan id="inz-leg-txt-3.1.1.tspan.1" dy="6.5" x="0">HighSchool</tspan>
                              </text>
                            </g>
                          </g>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.513.1">
                      <g id="GRID.cellGrob.467.1">
                        <g id="inz-leg-pt-4.1">
                          <use id="inz-leg-pt-4.1.1" href="#gridSVG.pch22" x="221.2" y="160.55" width="16" height="16" transform=" translate(-8,-8)" stroke="rgb(93,200,99)" stroke-width="1.25" fill="rgb(93,200,99)" stroke-opacity="1" fill-opacity="1" font-size="16"/>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.514.1">
                      <g id="GRID.cellGrob.468.1">
                        <g id="inz-leg-txt-4.1">
                          <g id="inz-leg-txt-4.1.1" transform="translate(240.4, 160.55)" stroke-width="0.1">
                            <g id="inz-leg-txt-4.1.1.scale" transform="scale(1, -1)">
                              <text x="0" y="0" id="inz-leg-txt-4.1.1.text" text-anchor="start" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                                <tspan id="inz-leg-txt-4.1.1.tspan.1" dy="6.5" x="0">SomeCollege</tspan>
                              </text>
                            </g>
                          </g>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.515.1">
                      <g id="GRID.cellGrob.469.1">
                        <g id="inz-leg-pt-5.1">
                          <use id="inz-leg-pt-5.1.1" href="#gridSVG.pch22" x="221.2" y="134.55" width="16" height="16" transform=" translate(-8,-8)" stroke="rgb(253,231,37)" stroke-width="1.25" fill="rgb(253,231,37)" stroke-opacity="1" fill-opacity="1" font-size="16"/>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.521::VP:LEGlayout::GRID.VP.522::GRID.VP.505::GRID.VP.516.1">
                      <g id="GRID.cellGrob.470.1">
                        <g id="inz-leg-txt-5.1">
                          <g id="inz-leg-txt-5.1.1" transform="translate(240.4, 134.55)" stroke-width="0.1">
                            <g id="inz-leg-txt-5.1.1.scale" transform="scale(1, -1)">
                              <text x="0" y="0" id="inz-leg-txt-5.1.1.text" text-anchor="start" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                                <tspan id="inz-leg-txt-5.1.1.tspan.1" dy="6.5" x="0">CollegeGrad</tspan>
                              </text>
                            </g>
                          </g>
                        </g>
                      </g>
                    </g>
                  </g>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
      <g id="container.6" font-size="16">
        <g id="container::VP:TOPlayout.7">
          <g id="container::VP:TOPlayout::GRID.VP.523.1">
            <g id="inz-main-sub-bottom.1">
              <g id="inz-main-sub-bottom.1.1" transform="translate(116.5, 11)" stroke-width="0.1">
                <g id="inz-main-sub-bottom.1.1.scale" transform="scale(1, -1)">
                  <text x="0" y="0" id="inz-main-sub-bottom.1.1.text" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1" font-size="12.8">
                    <tspan id="inz-main-sub-bottom.1.1.tspan.1" dy="5.5" x="0">285 missing values</tspan>
                  </text>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
      <g id="container.7" font-size="16">
        <g id="container::VP:TOPlayout.8">
          <g id="container::VP:TOPlayout::GRID.VP.524.1">
            <g id="container::VP:TOPlayout::GRID.VP.524::VP:PLOTlayout.1"/>
          </g>
        </g>
      </g>
      <g id="container.8" font-size="16">
        <g id="container::VP:TOPlayout.9">
          <g id="container::VP:TOPlayout::GRID.VP.524.2">
            <g id="container::VP:TOPlayout::GRID.VP.524::VP:PLOTlayout.2">
              <g id="container::VP:TOPlayout::GRID.VP.524::VP:PLOTlayout::GRID.VP.525.1" font-size="19.2">
                <g id="container::VP:TOPlayout::GRID.VP.524::VP:PLOTlayout::GRID.VP.525::GRID.VP.526.1">
                  <defs>
                    <clipPath id="container::VP:TOPlayout::GRID.VP.524::VP:PLOTlayout::GRID.VP.525::GRID.VP.526::VP:locate.these.points.1.clipPath">
                      <rect x="69.72" y="100.43" width="93.56" height="207.85" fill="none" stroke="none"/>
                    </clipPath>
                  </defs>
                  <g id="container::VP:TOPlayout::GRID.VP.524::VP:PLOTlayout::GRID.VP.525::GRID.VP.526::VP:locate.these.points.1" clip-path="url(#container::VP:TOPlayout::GRID.VP.524::VP:PLOTlayout::GRID.VP.525::GRID.VP.526::VP:locate.these.points.1.clipPath)">
                    <g id="inz-plot-bg.1.1.1">
                      <rect id="inz-plot-bg.1.1.1.1" x="69.72" y="100.43" width="93.56" height="207.85" transform="" fill="rgb(238,238,238)" stroke-dasharray="none" fill-opacity="1"/>
                    </g>
                    <g id="inz-y-grid.1.1.1">
                      <polyline id="inz-y-grid.1.1.1.1" points="69.72,100.43 163.28,100.43" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.2" points="69.72,131.33 163.28,131.33" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.3" points="69.72,162.23 163.28,162.23" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.4" points="69.72,193.14 163.28,193.14" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.5" points="69.72,224.04 163.28,224.04" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.6" points="69.72,254.94 163.28,254.94" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.7" points="69.72,285.85 163.28,285.85" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.8" points="69.72,316.75 163.28,316.75" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                    </g>
                    <g id="inz-bar-rev.1.1.1">
                      <polygon id="inz-bar-rev.1.1.1.1" points="145.5,100.43 145.5,298.38 162.34,298.38 162.34,100.43" fill="rgb(68,1,84)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.2" points="126.79,100.43 126.79,298.38 143.63,298.38 143.63,100.43" fill="rgb(68,1,84)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.3" points="108.08,100.43 108.08,215.4 124.92,215.4 124.92,100.43" fill="rgb(68,1,84)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.4" points="89.37,100.43 89.37,168.72 106.21,168.72 106.21,100.43" fill="rgb(68,1,84)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.5" points="70.66,100.43 70.66,139.33 87.5,139.33 87.5,100.43" fill="rgb(68,1,84)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.6" points="145.5,100.43 145.5,298.38 162.34,298.38 162.34,100.43" fill="rgb(59,82,139)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.7" points="126.79,100.43 126.79,298.38 143.63,298.38 143.63,100.43" fill="rgb(59,82,139)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.8" points="108.08,100.43 108.08,215.4 124.92,215.4 124.92,100.43" fill="rgb(59,82,139)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.9" points="89.37,100.43 89.37,168.72 106.21,168.72 106.21,100.43" fill="rgb(59,82,139)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.10" points="70.66,100.43 70.66,100.43 87.5,100.43 87.5,100.43" fill="rgb(59,82,139)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.11" points="145.5,100.43 145.5,298.38 162.34,298.38 162.34,100.43" fill="rgb(33,144,140)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.12" points="126.79,100.43 126.79,298.38 143.63,298.38 143.63,100.43" fill="rgb(33,144,140)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.13" points="108.08,100.43 108.08,215.4 124.92,215.4 124.92,100.43" fill="rgb(33,144,140)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.14" points="89.37,100.43 89.37,100.43 106.21,100.43 106.21,100.43" fill="rgb(33,144,140)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.15" points="70.66,100.43 70.66,100.43 87.5,100.43 87.5,100.43" fill="rgb(33,144,140)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.16" points="145.5,100.43 145.5,298.38 162.34,298.38 162.34,100.43" fill="rgb(93,200,99)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.17" points="126.79,100.43 126.79,298.38 143.63,298.38 143.63,100.43" fill="rgb(93,200,99)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.18" points="108.08,100.43 108.08,100.43 124.92,100.43 124.92,100.43" fill="rgb(93,200,99)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.19" points="89.37,100.43 89.37,100.43 106.21,100.43 106.21,100.43" fill="rgb(93,200,99)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.20" points="70.66,100.43 70.66,100.43 87.5,100.43 87.5,100.43" fill="rgb(93,200,99)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.21" points="145.5,100.43 145.5,298.38 162.34,298.38 162.34,100.43" fill="rgb(253,231,37)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.22" points="126.79,100.43 126.79,100.43 143.63,100.43 143.63,100.43" fill="rgb(253,231,37)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.23" points="108.08,100.43 108.08,100.43 124.92,100.43 124.92,100.43" fill="rgb(253,231,37)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.24" points="89.37,100.43 89.37,100.43 106.21,100.43 106.21,100.43" fill="rgb(253,231,37)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                      <polygon id="inz-bar-rev.1.1.1.25" points="70.66,100.43 70.66,100.43 87.5,100.43 87.5,100.43" fill="rgb(253,231,37)" stroke="none" stroke-width="0" stroke-opacity="0" fill-opacity="1"/>
                    </g>
                    <g id="inz-bar-line.1.1.1">
                      <polyline id="inz-bar-line.1.1.1.1" points="70.66,100.43 87.5,100.43" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.2" points="70.66,100.43 87.5,100.43" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.3" points="70.66,100.43 87.5,100.43" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.4" points="70.66,100.43 87.5,100.43" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.5" points="89.37,100.43 106.21,100.43" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.6" points="89.37,100.43 106.21,100.43" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.7" points="89.37,100.43 106.21,100.43" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.8" points="89.37,168.72 106.21,168.72" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.9" points="108.08,100.43 124.92,100.43" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.10" points="108.08,100.43 124.92,100.43" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.11" points="108.08,215.4 124.92,215.4" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.12" points="108.08,215.4 124.92,215.4" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.13" points="126.79,100.43 143.63,100.43" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.14" points="126.79,298.38 143.63,298.38" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.15" points="126.79,298.38 143.63,298.38" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.16" points="126.79,298.38 143.63,298.38" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.17" points="145.5,298.38 162.34,298.38" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.18" points="145.5,298.38 162.34,298.38" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.19" points="145.5,298.38 162.34,298.38" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-bar-line.1.1.1.20" points="145.5,298.38 162.34,298.38" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill="none"/>
                    </g>
                    <g id="inz-BAR.1.1.1">
                      <polygon id="inz-BAR.1.1.1.1" points="70.66,100.43 70.66,139.33 87.5,139.33 87.5,100.43" fill="none" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="0"/>
                      <polygon id="inz-BAR.1.1.1.2" points="89.37,100.43 89.37,168.72 106.21,168.72 106.21,100.43" fill="none" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="0"/>
                      <polygon id="inz-BAR.1.1.1.3" points="108.08,100.43 108.08,215.4 124.92,215.4 124.92,100.43" fill="none" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="0"/>
                      <polygon id="inz-BAR.1.1.1.4" points="126.79,100.43 126.79,298.38 143.63,298.38 143.63,100.43" fill="none" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="0"/>
                      <polygon id="inz-BAR.1.1.1.5" points="145.5,100.43 145.5,298.38 162.34,298.38 162.34,100.43" fill="none" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="0"/>
                    </g>
                  </g>
                  <g id="inz-rect-tp.1.1.1">
                    <rect id="inz-rect-tp.1.1.1.1" x="69.72" y="100.43" width="93.56" height="207.85" transform="" fill="none" fill-opacity="0"/>
                  </g>
                  <g id="container::VP:TOPlayout::GRID.VP.524::VP:PLOTlayout::GRID.VP.525::GRID.VP.526::GRID.VP.527.1">
                    <g id="inz-labelText.1">
                      <g id="inz-labelText.1.1" transform="translate(79.08, 98.54)" stroke-width="0.1">
                        <g id="inz-labelText.1.1.scale" transform="scale(1, -1)">
                          <text x="0" y="0" id="inz-labelText.1.1.text" transform="rotate(-30)" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1" font-size="10.24">
                            <tspan id="inz-labelText.1.1.tspan.1" dy="10" x="0">8thGrade</tspan>
                          </text>
                        </g>
                      </g>
                      <g id="inz-labelText.1.2" transform="translate(97.79, 98.54)" stroke-width="0.1">
                        <g id="inz-labelText.1.2.scale" transform="scale(1, -1)">
                          <text x="0" y="0" id="inz-labelText.1.2.text" transform="rotate(-30)" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1" font-size="10.24">
                            <tspan id="inz-labelText.1.2.tspan.1" dy="10" x="0">9_11thGrade</tspan>
                          </text>
                        </g>
                      </g>
                      <g id="inz-labelText.1.3" transform="translate(116.5, 98.54)" stroke-width="0.1">
                        <g id="inz-labelText.1.3.scale" transform="scale(1, -1)">
                          <text x="0" y="0" id="inz-labelText.1.3.text" transform="rotate(-30)" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1" font-size="10.24">
                            <tspan id="inz-labelText.1.3.tspan.1" dy="10" x="0">HighSchool</tspan>
                          </text>
                        </g>
                      </g>
                      <g id="inz-labelText.1.4" transform="translate(135.21, 98.54)" stroke-width="0.1">
                        <g id="inz-labelText.1.4.scale" transform="scale(1, -1)">
                          <text x="0" y="0" id="inz-labelText.1.4.text" transform="rotate(-30)" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1" font-size="10.24">
                            <tspan id="inz-labelText.1.4.tspan.1" dy="10" x="0">SomeCollege</tspan>
                          </text>
                        </g>
                      </g>
                      <g id="inz-labelText.1.5" transform="translate(153.92, 98.54)" stroke-width="0.1">
                        <g id="inz-labelText.1.5.scale" transform="scale(1, -1)">
                          <text x="0" y="0" id="inz-labelText.1.5.text" transform="rotate(-30)" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1" font-size="10.24">
                            <tspan id="inz-labelText.1.5.tspan.1" dy="10" x="0">CollegeGrad</tspan>
                          </text>
                        </g>
                      </g>
                    </g>
                    <g id="inz-yaxis-left.1.1.1" font-size="12.8">
                      <g id="major.1">
                        <polyline id="major.1.1" points="69.72,131.33 69.72,285.85" fill="none"/>
                      </g>
                      <g id="ticks.1">
                        <polyline id="ticks.1.1" points="69.72,131.33 58.2,131.33" fill="none"/>
                        <polyline id="ticks.1.2" points="69.72,162.23 58.2,162.23" fill="none"/>
                        <polyline id="ticks.1.3" points="69.72,193.14 58.2,193.14" fill="none"/>
                        <polyline id="ticks.1.4" points="69.72,224.04 58.2,224.04" fill="none"/>
                        <polyline id="ticks.1.5" points="69.72,254.94 58.2,254.94" fill="none"/>
                        <polyline id="ticks.1.6" points="69.72,285.85 58.2,285.85" fill="none"/>
                      </g>
                      <g id="labels.1">
                        <g id="labels.1.1" transform="translate(46.68, 131.33)" stroke-width="0.1">
                          <g id="labels.1.1.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.1.text" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.1.tspan.1" dy="7.5" x="0">0.05</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.2" transform="translate(46.68, 162.23)" stroke-width="0.1">
                          <g id="labels.1.2.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.2.text" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.2.tspan.1" dy="7.5" x="0">0.10</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.3" transform="translate(46.68, 193.14)" stroke-width="0.1">
                          <g id="labels.1.3.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.3.text" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.3.tspan.1" dy="7.5" x="0">0.15</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.4" transform="translate(46.68, 224.04)" stroke-width="0.1">
                          <g id="labels.1.4.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.4.text" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.4.tspan.1" dy="7.5" x="0">0.20</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.5" transform="translate(46.68, 254.94)" stroke-width="0.1">
                          <g id="labels.1.5.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.5.text" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.5.tspan.1" dy="7.5" x="0">0.25</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.6" transform="translate(46.68, 285.85)" stroke-width="0.1">
                          <g id="labels.1.6.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.6.text" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.6.tspan.1" dy="7.5" x="0">0.30</tspan>
                            </text>
                          </g>
                        </g>
                      </g>
                    </g>
                    <g id="inz-yaxis-right.1.1.1" font-size="12.8">
                      <g id="major.2">
                        <polyline id="major.2.1" points="163.28,131.33 163.28,285.85" fill="none"/>
                      </g>
                      <g id="ticks.2">
                        <polyline id="ticks.2.1" points="163.28,131.33 174.8,131.33" fill="none"/>
                        <polyline id="ticks.2.2" points="163.28,162.23 174.8,162.23" fill="none"/>
                        <polyline id="ticks.2.3" points="163.28,193.14 174.8,193.14" fill="none"/>
                        <polyline id="ticks.2.4" points="163.28,224.04 174.8,224.04" fill="none"/>
                        <polyline id="ticks.2.5" points="163.28,254.94 174.8,254.94" fill="none"/>
                        <polyline id="ticks.2.6" points="163.28,285.85 174.8,285.85" fill="none"/>
                      </g>
                    </g>
                  </g>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
    </g>
  </g>
</svg> 
      </div>
      <div class = "tbl-div table-responsive">
<table id="table" class="table table-condensed table-hover" cellspacing="0">
<caption>Table of Counts and Proportions</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> 8thGrade </th>
   <th style="text-align:center;"> 9_11thGrade </th>
   <th style="text-align:center;"> HighSchool </th>
   <th style="text-align:center;"> SomeCollege </th>
   <th style="text-align:center;"> CollegeGrad </th>
   <th style="text-align:center;"> Total </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Counts </td>
   <td style="text-align:center;"> 45 </td>
   <td style="text-align:center;"> 79 </td>
   <td style="text-align:center;"> 133 </td>
   <td style="text-align:center;"> 229 </td>
   <td style="text-align:center;"> 229 </td>
   <td style="text-align:center;"> 715 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Percent </td>
   <td style="text-align:center;"> 6.29% </td>
   <td style="text-align:center;"> 11.05% </td>
   <td style="text-align:center;"> 18.6% </td>
   <td style="text-align:center;"> 32.03% </td>
   <td style="text-align:center;"> 32.03% </td>
   <td style="text-align:center;"> 100% </td>
  </tr>
</tbody>
</table>
      </div>
    </div>

    <!-- help guide -->
    <div class = "help-overlay">
      <div class= "help-info">
        <h4> <span class = "glyphicon glyphicon-question-sign title"> </span> Help </h4>
        <span class = "glyphicon glyphicon-stats"> </span><strong> Plot </strong> show/hide plot <br />
        <span class = "glyphicon glyphicon-list-alt"> </span><strong> Table </strong> show/hide table <br/>
        <span class = "glyphicon glyphicon-refresh"> </span><strong> Reset </strong> clear all selections/return <br />
        <strong>Variable to display</strong> select variable/s to display in plot <br/>
        <br/>
        <h5>PLOT SELECTION</h5>
        <strong> Click </strong> for a single selection <br />
        Hold <strong>Shift + Click</strong> for multiple selections  <br/>
        (disabled for bar charts) <br/>
        <strong>Drag + hold</strong> to draw a selection box <br/>
        <br/>
        <h5> TABLE SELECTION </h5> (disabled for bar charts) <br/>
        <strong> Click </strong> on a row for a single selection <br />
        Click again on the same row to deselect it <br />
        <br/>
        <h5>ADDITIONAL FEATURES FOR MAPS</h5>
        <strong>Slider:</strong> Drag to view a certain time period <br />
        <strong>Pan and Zoom:</strong> Drag/scroll mouse <br />
        <hr />
        Found a bug or got suggestions? Contact us!  <br/>
        <a href="https://www.stat.auckland.ac.nz/~wild/iNZight/support/contact/">
          <img alt = "inzight-logo" class="logo" src = "https://www.stat.auckland.ac.nz/~wild/iNZight/img/inzight_transp.png" />
        </a>
      </div>
    </div>
<script type='text/javascript'> var chart = {"type":["bar"],"data":[{"othervar":"A","varx":"8thGrade","counts":45,"pct":6.29},{"othervar":"A","varx":"9_11thGrade","counts":79,"pct":11.05},{"othervar":"A","varx":"HighSchool","counts":133,"pct":18.6},{"othervar":"A","varx":"SomeCollege","counts":229,"pct":32.03},{"othervar":"A","varx":"CollegeGrad","counts":229,"pct":32.03}],"colorMatch":[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0],"colCounts":{},"group":[5],"order":{}};
/** Interactivity for iNZightPlots
 * For each plot there's a sub-class which extends with this class `inzplot`.
 * This class applies for all single panel plots generated with the iNZightPlots
 * package in R.
 * Functions that apply for this class apply for all subclasses.
 * Hierarchy of plots: inzplot -> {hexbin, histogram, dotscatter, bar}
 *                     inzmap -> {region, centroid, sparklines}
 * Additional classes/components: boxplot, legend, table, sparkplot
 * @param {Object} chart - chart.json from R (which includes all data, and
 * other params for identifying the chart originally drawn in R)
 * The relevant plot class is called in the onload function (scroll to the bottom of
 * this script, or search for 'ON LOAD FUNCTION').
 * NOTE: If it so happens that iNZightPlots gets rewritten/gridSVG no longer gets used,
 * it's best to rewrite everything.
 * Naming of grid objects is very important especially when exporting with gridSVG
 * for targeting certain elements and groups of elements. */
class Inzplot {

  constructor(chart) {
    // set svg so that there's variable width and height based on div
    this.svg = d3.select("svg")
                 .attr("width", null)
                 .attr("height", null);
    this.chart = chart;
    this.chartType = chart.type[0];
    this.data = chart.data;
    this.count = this.data.length;
    this.Grob = this.getGrob(this.chartType);
    this.levelNo = (chart.levNames) ? chart.levNames.length : 1;
    this.panel = document.getElementById(this.Grob);
  }

  // create a tooltip for the plot
  setTooltip(width, height = null) {
    var tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .attr("id", "tooltip")
                    .style("width", width)
                    .style("height", height);
    this.tooltip = tooltip;
    return tooltip;
  }

  /** Identifying the 'Grob' in the chart
   * (where do all our bars/dots/hexagons lie?)
   * @param {String} chartType - the type of chart identified
   * @return Grob identifier */
  getGrob(chartType) {
    var polygon = document.getElementsByTagName('polygon'),
        p, Grob;
    switch(chartType) {
      case "hist":
      p = polygon[2];
      break;

      case "bar":
      p = polygon[polygon.length - 1];
      break;

      case "dot":
      Grob = 'g[id^="inz-DOTPOINTS."]';
      break;

      case "scatter":
      // test if there's a raster map (originally GRID.rastergrob)
      // OR: you could change the grid name in iNZightMaps package to inz-SCATTERPOINTS...
       Grob = (document.querySelectorAll('g[id^="background.map"]').length > 0) ?
              'g[id^="SCATTERPOINTS."]' : 'g[id^="inz-SCATTERPOINTS."]';
      break;

      default:
      // for hexbins, bp-stacked
      p = polygon[0];
      break;
    }

    if (p) {
      var id = p.getAttribute('id');
      Grob = id.substring(0, id.lastIndexOf('.'));
    }

    return Grob;
  }

  // Functions for enabling brushing over elements (selection box)
  // `brushmove` differs for each plot (depending on what is being
  // accumulated) - see respective subclasses to change this

  /** Enable brushing on plot
   * @param node - an element to target and add brush to
   * @param {Number} selector - where exactly do you want to insert brush
   * @param {Boolean} text - if an additional paragraph should be added
   * This is generally true for histograms/hexbins to show accumulated data when
   * brushing, otherwise false. */
  enableBrush(node, selector, direction = "xy", text = false) {
    if (text) {
      d3.select('#control').append("p")
                   .attr('class', 'brush-info');
    }

    // append brush:
    var svg = d3.select('svg');
    var brush = (direction === "x") ? d3.brushX() : d3.brush();

    brush.on("start", this.brushstart)
         .on("brush", this.brushmove)
         .on("end", this.brushend);

    d3.select(node)
      .insert("g", "g:nth-child(" + selector + ")")
      .attr("class", "brush")
      .call(brush);

    // make handles invisible:
    d3.selectAll('.handle')
      .style('opacity', 0);
    d3.select('.overlay')
      .attr("width", "100%")
      .attr("height", "100%")
      .style('stroke', 'none');
  }

  brushend() {
    if (!d3.event.selection) {
      d3.select(".selection")
        .style("display", "none");
    }
  }

  // When user begins brushing
  brushstart() {
    d3.select(".selection")
      .style("display", null);
  }

}

/** TABLE CLASS
 * Includes setup with the DataTables library
 * Any additional functions related to the table can be added here */
class Table {

  constructor(chartType) {
    this.chartType = chartType;
  }

  /** Initializing table using DataTables
   * To apply styles and formats onto table from the DataTables library
   * @param {string} chartType - type of chart shown
   * For bar plots, rows and columns ordering should be disabled (to link
   * cells properly to bars + additional rows added)
   * For all other plots, there's an ID column added where each row represents
   * an element (a bar, a point, a region, a hexagon, e.t.c). */
  setDT(chartType) {
    var table;

    if (chartType === "bar" || chartType === "bp-stacked") {
      table = $('#table').DataTable({
          "colReorder": true,
          //disable ordering and sorting
          "ordering": false,
          "aaSorting": []
      });
    } else {
      table = $('#table').DataTable({
          "colReorder": true,
          "columnDefs": [
            { //hide rowID column
              "targets": [0],
              "visible": false
            }
          ]
        });
    }
    this.DT = table;
  }

  // This is used to drive the table button
  // For bar plots, it will hide percent/count conversion buttons
  showTable() {
    $('#table_wrapper').toggleClass('hidden');
    $('.Percentage').toggleClass('hidden');
    $('.Count').toggleClass('hidden');
  }

  // Table to plot linking:
  tableToPlot(table, panel, element) {
    $('#table tbody').on('click', 'tr', function() {
      $(this).toggleClass('active');
          let ind = table.rows('.active')[0];
          let selector = "." + element;
          d3.select(panel).selectAll(selector)
            .attr("class", function(d, i) {
                return (ind.includes(i) ? element + " selected" : element + " none");
        });
      //clear brush
      d3.selectAll('.selection')
        .style("display", "none");
    });
  }

  // This is used to widen columns when there are more than 3
  // columns in the table
  widenColumns() {
    // make tables not go wide when there's only 1 column
    if (chart.type !== "bar") {
      var ncol = $("#table thead tr th").length;
      if (ncol < 3) {
        $('#table').css('width', '50%');
      } else if (ncol <= 4) {
        $('#table').css('width', '75%');
      } else {
        $('#table').css('width', '100%');
      }
    } else {
      $('#table').css('width', '100%');
    }
  }

  // initialize table
  init() {
    this.setDT(this.chartType);
    this.widenColumns();
    // attach event handlers:
    d3.select("#viewTable")
      .on("click", this.showTable);
  }

}


/** BOX PLOT CLASS
 * For setting up interactivity and labels for box plots
 * In cases where there are box plots present on the plot
 * (specifically for dot plots and histograms), this will attach interactivity
 * and label parts of the box plot when the user hovers/clicks on the box plot
 * @param {Object} chart - chart information from R
 * (ie factor levels, generally defaults to 1) */
class Boxplot {

  constructor(chart) {
    this.levelNo = (chart.levNames) ? chart.levNames.length : 1;
    this.boxData = chart.boxData;
    this.polygonBox = document.querySelectorAll('g[id^="inz-box."]');
    this.boxLines = document.querySelectorAll('g[id^="inz-box-line."]');
  }

  /** Main function to process and add labels, along with interactions for the
   * box plot
   * @param {Number} levelNo - number of levels/factors in the plot
   */
  boxMe(levelNo) {
    var polygonBoxes = this.polygonBox;
    var boxLines = this.boxLines;

    for (let i = 1; i <= levelNo; i++) { //separate boxes for each plot
      var polygonBox = polygonBoxes[i-1].children;
      var boxLine = boxLines[i-1].children;
      for (let j = 0; j < 2; j++) {
        polygonBox[j].setAttribute('class', 'box-' + i);
        boxLine[j].setAttribute('class', 'box-' + i);
      }
      this.boxLabelSet(i, 0, 1, 0,'LQ');
      this.boxLabelSet(i, 1, 2, 2, 'UQ');
      this.boxLabelSet(i, 1, 0, 1, 'Median');
      this.boxLabelSet(i, 1, 0, 3, 'Min');
      this.boxLabelSet(i, 2, 1, 4, 'Max');
    }

    //Box Plot interactions:
    for (let j = 1; j <= levelNo; j++) {
    var box = document.getElementsByClassName('box-' + j);
    for (let i = 0; i < box.length; i++) {
      box[i].setAttribute('onmouseover', 'fillBox(' + j + ')');
      box[i].setAttribute('onmouseout', 'normalBox(' + j + ')');
      box[i].setAttribute('onclick', 'showBox(' + j + ')');
      }
    }

  }

  /** Create box labels (min, max, mean, lower quartile, upper quartile)
   * This is used to append text onto the SVG
   * @param {Number} i - designated number that indicates what label it is
   * @param {String} textinput - the label
   * @param panel - where to append these svg labels to (generally this.panel
   * is already identified)
   * @param {Number} x - x-coordinate of where label is positioned
   * @param {Number} y - y-coordinate of where label is positioned
   * @return Appends labels onto SVG in correct positions
   */
  boxLabel(i, textinput, panel, x, y) {
  var boxLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
    boxLabel.setAttribute('class', 'label boxData-' + i + ' hidden');
    boxLabel.setAttributeNS(null, 'transform', 'translate(' + Number(x) + ',' + (Number(y) + 2) + ') scale(1, -1)');
    boxLabel.setAttributeNS(null, 'id', textinput);

    var textNode = document.createTextNode(textinput);
    boxLabel.appendChild(textNode);
    panel.appendChild(boxLabel);
  }

  /** Sets all labels relative to the box plot and its information
   * This function sets all the labels for the box plot at once.
   * @param {Number} i
   * @param {Number} p
   * @param {Number} r
   * @param {Number} q
   * @param {String} textinput - Label (either: Min, Max, Median, LQ, UQ)
   */
  boxLabelSet(i, p, r, q, textinput) {

    if (textinput == "Min" ||  textinput == "Max") {
      var line = document.getElementById('inz-box-line.1.1.' + i  + '.1.' + p); //i is levelNo.
      // p will either be 1 or 2 -> 1 = minLine, 2 = maxLine
      line.setAttribute('class', 'box-' + i);
      var boxPoints = line.getAttribute('points').split(" ")[r].split(",");
      var panel = line.parentNode;
    } else {
      var box = document.getElementsByClassName('box-' + i)[p];
      // boxplot split into two boxes - lowerbox (p = 0) and upperbox (p = 1)
      var boxPoints = box.getAttribute('points').split(" ")[r].split(",");
      var panel = box.parentNode;
    }

    var x = boxPoints[0], y = boxPoints[1], text;

    if (textinput == "Median") {
      // move median label below the box plot
     y = boxPoints[1] - 11;
    }
    if (this.levelNo === 1) {
      text = textinput + ": " + this.boxData[q].quantiles;
    } else {
      text = textinput + ": " + this.boxData[i-1][q].quantiles;
    }
    // this is associated with the boxData imported from R.
    //q = 0 (LQ), 1 (UQ), 2 (Median), 3 (Min), 4 (Max)
    this.boxLabel(i, text, panel, x, y);
  }

  init() {
    this.boxMe(this.levelNo);
  }

}

// functions for box plot event handling:
fillBox = function(j) {
  d3.selectAll('.box-' + j)
    .classed('fillBox', true);
};

normalBox = function(j) {
  d3.selectAll('.box-' + j)
    .classed('fillBox', false);
  };

showBox = function(j) {
  var boxData = d3.selectAll('.boxData-' + j);
    boxData.classed('hidden', !boxData.classed('hidden'));
}

class MeanIndicator {
  constructor(props) {
    console.log(props);
    this.mean = props.meanData;
    this.levelNo = (chart.levNames) ? chart.levNames.length : 1;
    // this.boxData = chart.boxData;
    this.meanPoint = document.querySelectorAll('g[id^="inz-mean."]');
  }
  
  init() {
    for (let i = 1; i <= this.levelNo; i++) {
      this.addMouseOver(i - 1);
    }
  }
  
  addMouseOver(i) {
    var x = this.meanPoint[i].getElementsByTagName("use")[0].getAttribute('x');
    var y = this.meanPoint[i].getElementsByTagName("use")[0].getAttribute('y');
    var transf = this.meanPoint[i].getElementsByTagName("use")[0].getAttribute('transform').toString();
    
    var d = transf.slice(transf.indexOf('translate(') + 10, -1).split(',');
    
    
    var meanLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
    // boxLabel.setAttribute('class', 'label boxData-' + i + ' hidden');
    // meanLabel.setAttributeNS(null, 'x', x);
    // meanLabel.setAttributeNS(null, 'y', y);
    meanLabel.setAttributeNS(null, 'transform', 'translate(' + Number(x) + ', ' + (Number(y) - Number(d[1])) + ') scale(1, -1)');
    meanLabel.setAttributeNS(null, 'dominant-baseline', 'baseline');
    // meanLabel.setAttributeNS(null, 'text-anchor', 'start');
    meanLabel.setAttribute('class', 'label hidden group-mean-label');
    meanLabel.setAttribute('id', 'group-mean-' + i);
    // boxLabel.setAttributeNS(null, 'id', textinput);
    
    var textNode = document.createTextNode(this.mean[i]);
    meanLabel.appendChild(textNode);
    this.meanPoint[i].appendChild(meanLabel);
    
    this.meanPoint[i].setAttribute('onclick', 'showMean(' + i + ')');
    this.meanPoint[i].setAttribute('style', 'cursor: pointer');
    
    return this;
  }
}

showMean = function(i) {
  var boxData = d3.select('#group-mean-' + i);
    boxData.classed('hidden', !boxData.classed('hidden'));
}


/** LEGEND CLASS
 * For attaching legend interactivity
 * Includes trend line interactivity for scatter plots
 * Generally for coloured bar plots, colored dot plots and scatter plots
 * @param props - generally refers to the plot class identified */
class Legend {

  constructor(props) {
    this.legendLayout = document.getElementById('inz-leg-layout.1');
    this.legLineLayout = document.getElementById('inz-leg-lines.1');
    this.levelNo = (props.levelNo) ? props.levelNo : 1;
    this.chartType = props.chartType;
    this.colGroupNo = props.colGroupNo;
    this.varNames = props.chart.varNames;
    this.Grob = props.Grob;
    this.tbl = props.tbl;
    this.trendInfo = props.chart.trendInfo;
  }

  // This is used to enable legend interactivity for dot plots and scatter plots
  enableHandlers() {
    if (!this.legendLayout) return;
    let colGroupNo = this.colGroupNo;

    //grab legend text and respective key:
    let keyText = document.querySelectorAll('tspan[id^="inz-leg-txt-"]');
    let key = document.querySelectorAll('use[id^="inz-leg-pt-"]');
    let Grob = this.Grob;
    let table = this.tbl;
    let varNames = this.varNames;

    function subset(i) {
      let ind = i + 1;
      //get the title variable:
      var titleVar = document.getElementById('inz-leg-title.1.1.tspan.1').textContent;
      var key = document.getElementById('inz-leg-pt-' + ind + '.1.1');
      var keyText = document.getElementById('inz-leg-txt-' + ind + '.1.1.tspan.1').textContent;
      var names = varNames;
      var count = document.getElementsByClassName('point').length;
      var el = document.querySelectorAll(Grob);

      for (let j = 1; j <= count; j++) {
          var point = document.getElementById(el[0].id + '.' + j);
          if (key.getAttribute('fill') == point.getAttribute('stroke')) {
              point.setAttribute('class', 'point selected');
          } else {
              point.setAttribute('class', 'point none');
          }
      }

      // find column index + filter: (add one for hidden column)
      var colInd = names.indexOf(titleVar) + 1;
      table.search('').columns().search('').draw();
      table.columns(colInd).search("^" + keyText + "$", true, false).draw();
    }

    this.addHandlers(subset);
  }

  /** Add interactivity to key and text in legend
   * @param {Function} subset - A function to filter by a certain group when
   * user clicks on the group (e.g. dots + table are filtered)
   * In this case, the subset function is different for dot plots/scatter plots
   * and for bar plots. However, the hovers are practically the same (show/out functions) */
  addHandlers(subset) {
    let keyText = document.querySelectorAll('tspan[id^="inz-leg-txt-"]');
    let key = document.querySelectorAll('use[id^="inz-leg-pt-"]');

    function show(i) {
      let ind = i + 1;
      let circle = document.getElementById('inz-leg-pt-' + ind + '.1.1');
      let text = document.getElementById('inz-leg-txt-' + ind + '.1.1.tspan.1');
      if (circle.getAttribute("fill") !== "none") {
            text.setAttribute('fill', circle.getAttribute('fill'));
        } else {
            text.setAttribute('fill', circle.getAttribute('stroke'));
        }
      circle.setAttribute("class", "show");
      text.setAttribute("class", "show");
    }

    function out(i) {
      let ind = i + 1;
      let keyText = document.getElementById('inz-leg-txt-' + ind + '.1.1.tspan.1');
      let key = document.getElementById('inz-leg-pt-' + ind + '.1.1');
      keyText.setAttribute("class", "out keyText");
      key.setAttribute("class", "show");
    }

    // text handlers:
    d3.selectAll(keyText)
      .on("mouseover", (d, i) => show(i))
      .on("mouseout", (d, i) => out(i))
      .on("click", (d, i) => subset(i));

    // circle handlers:
    d3.selectAll(key)
      .on("mouseover", (d, i) => show(i))
      .on("mouseout", (d, i) => out(i))
      .on("click", (d, i) => subset(i));
  }

  /** This is used to enable trend line interactivity
   * Primarily adds interactivity to trend lines
   * @param {String} t - trend line class ("linear", "quadratic", "cubic")
   * @param {String} g - HTML label generated for the trend line
   * @param ptip - d3 object for tooltip
   * Only found on scatter plots only */
  enableTrends(t, g, ptip) {
    let legLineLayout = this.legLineLayout;

    d3.select(legLineLayout).selectAll("." + t)
    .on('mouseover', function() {
        d3.select(this).style("opacity", 0.5);
    })
    .on('mouseout', function() {
        d3.select(this).style("opacity", 1);
    })
    .on('click', function() {
        d3.selectAll('.trend')
        .classed('hidden', function() {
          return((this.getAttribute('class').includes(t) === true) ? false : true);
      });

      return ptip.classed("hidden", false)
                 .html(g);
        });

    d3.selectAll(".trend." + t)
      .on("mouseover", function() {
          d3.select(".tooltip")
            .style("left", d3.event.pageX - 50 + "px")
            .style("top", d3.event.pageY - 50 + "px")
            .style("visibility", "visible")
            .html(g);
          })
      .on("mouseout", function() {
          d3.select(".tooltip")
            .style("visibility", "hidden");
          })
  }

  /** Get the equation of the trend line and create tooltip labels
   * @param t - type of trend identified ("Linear", "Quadratic", "Cubic")
   * @return returns HTML for tooltip label
   * trendInfo is stored in chart information */
  getEquation(t) {
    let trendInfo = this.trendInfo;
    switch(t) {
        case "linear":
        return "Linear fit:" + "<span> y = " + trendInfo[t][0] + " " +
               (trendInfo[t][1] > 0 ? ("+" + trendInfo[t][1]) : trendInfo[t][1])
               + "x " + "</span> <br />" + "R" + "<sup>2</sup> : " + "<span>"
               + trendInfo[t][2] + "</span>";
        break;

        case "quadratic":
        return "Quadratic fit:" + "<span> y = " + trendInfo[t][0] + " "
               + (trendInfo[t][1] > 0 ? ("+" + trendInfo[t][1]) : trendInfo[t][1])
               + "x " + (trendInfo[t][2] > 0 ? ("+" + trendInfo[t][2]) : trendInfo[t][2])
               + "x<sup>2</sup>" + "</span>" + "<br />"+ "R" + "<sup>2</sup> : " + "<span>"
               + trendInfo["rank.cor"][0] + "</span>";
        break;

        case "cubic":
        return "Cubic fit: <span> y = " + trendInfo[t][0] + " " +
               (trendInfo[t][1] > 0 ? ("+" + trendInfo[t][1]) : trendInfo[t][1])
               + "x " + (trendInfo[t][2] > 0 ? ("+" + trendInfo[t][2]) : trendInfo[t][2])
               + "x<sup>2</sup> " + (trendInfo[t][3] > 0 ? ("+" + trendInfo[t][3]) : trendInfo[t][3])
               + "x<sup>3</sup> </span>" + "<br />" +  "R" + "<sup>2</sup> : <span>"
               + trendInfo["rank.cor"][0] + "</span>";
        break;

        default:
        return "Invalid trend!";
    }
  }

  /** For identifying if there is a separate trend line legend present
   * Main function for enabling interactivity for trend lines */
  trendLegend() {
    // if there is no legend, return:
    if (!this.legLineLayout) return;

    let trendInfo = this.trendInfo;
    var lines = d3.select(this.legLineLayout).selectAll('polyline')
                  .attr('class', function() {
                    var id = this.id;
                    var type = id.substring(id.lastIndexOf("-") + 1, id.indexOf("."));
                    return type;
                  });
    var keys = d3.select(this.legLineLayout).selectAll('tspan')
                 .attr('class', function() { return this.innerHTML; });

    //insert text into the control panel:
    var ptip = d3.select('#control')
             .append("p")
             .attr('class', 'trend-info')
             .classed("hidden", true);

   var ll = this.legLineLayout.querySelectorAll('tspan');

   //loop over lines
   for (var i = 0; i < ll.length; i++) {
       var t = ll[i].innerHTML;
       var line = document.getElementById('inz-trend-' + t + '.1.1.1.1');
       line.setAttribute('class', t + ' trend');

       var g = this.getEquation(t);
       this.enableTrends(t, g, ptip);
   }
  }

  // To initialize legend interactivity (both trendlines and groups)
  init() {
    // enable handlers on legend
    this.enableHandlers();
    //enable trend legend handlers:
    this.trendLegend();
  }

}

/** =================================================
  ON LOAD FUNCTION
  Facilitates all toggles on navigation bar and
  initializes appropriate plot
 ================================================== **/

$(function() {
  $(".view-tbl").click(function() {
    $(".tbl-div").removeClass("expand").toggleClass("moveRight");
    $(".svg-div").removeClass("moveLeft").toggleClass("mid");
    // for bars:
    $(".Percentage").toggleClass("hidden");
    $(".Count").toggleClass("hidden");
  });

  $(".plot").click(function() {
    $(".svg-div").removeClass("mid").toggleClass("moveLeft");
    $(".tbl-div").removeClass("moveRight").toggleClass("expand");
  });

  $(".help").click(function() {
    $(".help-overlay").toggleClass("move");
  });

  $(".help-overlay").click(function() {
    $(".help-overlay").toggleClass("move");
  });

  // load chart:
  var plot;

  switch(chart.type[0]) {
    //for inzplots:
    case "hex":
    plot = new Hexbin(chart);
    break;

    case "hist":
    plot = new Histogram(chart);
    break;

    case "dot":
    case "scatter":
    plot = new DotScatter(chart);
    break;

    case "bar":
    plot = new UnstackedBar(chart);
    break;

    case "bp-stacked":
    plot = new StackedBar(chart);
    break;

    //for inzmaps:
    case "region":
    plot = new RegionMap(chart);
    break;

    case "point":
    plot = new CentroidMap(chart);
    break;

    case "sparklines":
    plot = new SparkMap(chart);
    break;

    default:
    return;
  }

  plot.init();
  console.log("Load complete!");

});
/** CLASSES FOR BAR PLOTS
 * Generic class for all bar plots
 * Split into subclasses: stacked (type = "bp-stacked"), unstacked (type = "bar")
 * @param props - parameters from Inzplot (chart)
 */
class Barplot extends Inzplot {

  constructor(props) {
    super(props);
    this.plotRegion = document.querySelectorAll('rect[id^="inz-plot-bg"]')[0];
    this.reset = this.reset.bind(this);

    // parameters for bar charts
    this.colorMatch = this.chart.colorMatch;
    this.colCounts = this.chart.colCounts;
    this.group = this.chart.group[0];

    //bind event handlers
    this.changeToPercent = this.changeToPercent.bind(this);
    this.changeToCount = this.changeToCount.bind(this);
    this.reset = this.reset.bind(this);
  }

  // this is used before initializing DataTables
  // for labelling columns and rows for conversion/highlighting
  setTable() {
    let table = document.getElementById("table");
    let tableAttr = {
      table: table,
      tr: table.getElementsByTagName("tr"),
      ncol: table.getElementsByTagName("tr")[0].childElementCount, //no. of columns
      td: table.getElementsByTagName('td'),
      cellNo: table.getElementsByTagName("td").length, //cellNo
      nrow: table.rows.length, // no. of rows
      colorMatch: this.colorMatch,
      colCounts: this.colCounts,
      number: this.data.length,
      count: this.data.length + 1
    };
    this.tableAttr = tableAttr;
    return tableAttr;
  }

  //inserting x-header
  insertXHeader() {
    let table = this.tableAttr.table;
    let ncol = this.tableAttr.ncol;
    var xrow = table.insertRow(0);
    var xhead = xrow.insertCell(0);
    xhead.setAttribute("class", "headings");
    xhead.innerHTML = document.getElementsByTagName("tspan")[2].innerHTML;
    xhead.colSpan = ncol;
    return xhead;
  }

  // inserting y-header
  insertYHeader() {
    var yHeading = document.getElementsByTagName('th')[0];
    yHeading.innerHTML = document.getElementsByTagName('tspan')[3].innerHTML;
    yHeading.setAttribute('class',' headings');
    return yHeading;
  }

  // screening through selecting which bars to be interactive
  // R currently draws bars on top of each other
  screenBars(colorMatch = this.colorMatch) {
    var Grob = this.Grob;
    var type = this.chartType;
    var data = this.data;

    if (colorMatch[0] === null) {
      var bars = d3.select(this.panel).selectAll('polygon');
      return bars;
    }

    //if the bar plot is colored, it has additional bars and polylines to hide
    var p = document.getElementsByTagName('polygon');
    // if stacked:
    if (type === "bp-stacked") {
      d3.selectAll(p)
        .attr("class", function(d, i) {
          return (this.id.indexOf(Grob) >= 0) ? "bar" : "hidden";
        });
    } else {
      d3.selectAll(p)
        .attr("id", function(d, i) {
          if (colorMatch[i] === 1) return Grob + "." + (i/(data.length - 1));
        })
        .attr("class", function(d, i) {
          return (colorMatch[i] === 1) ? "bar" : "hidden";
        });
    }

    //Hiding polylines:
    var barLines = document.getElementById('inz-bar-line.1.1.1');
    d3.select(barLines).selectAll('polyline')
      .classed("hidden", true);
    var bars = d3.select('svg').selectAll('.bar');

    return bars;
  }

  // to enable tooltips
  makeTooltips(bars, data = this.data) {
    let count = this.count;
    let table = this.tbl;
    let tooltip = this.tooltip;
    let type = this.chartType;

    bars.data(data)
        .attr('class', 'bar')
        .on('mouseover', function(d) {
              var el = d3.select(this),
                  coords = el.attr('points'),
                  small = coords.split(" ")[0],
                  sx = Number(small.split(",")[0]),
                  coordsxy = coords.split(" ")[2],
                  x = Number(coordsxy.split(",")[0]),
                  xx = x + (sx-x)/2 - 50,
                  y = Number(coordsxy.split(",")[1]) + 60,
                  //translate to html co-ordinates
                  tm = this.getScreenCTM().translate(+ xx, + y);

              tooltip.style('visibility', 'visible')
                     .style("left", (window.pageXOffset + tm.e)  + "px")
                     .style("top", (window.pageYOffset +tm.f)  + "px");

              if (data[0].var1 !== undefined) { // for 2-way tables
                tooltip.html("<span>" + d.var1 + ' ' + d.var2+ "<br/> " + d.pct +
                "%</span>" + "<br/>" + d.counts);
              } else if (data[0].Var1 !== undefined) { //for stacked
                tooltip.html("<span>" + d.Var1 + ' ' + d.Var2 + "<br> " + d.pct +
                "%</span>" + "<br>" +
                d.counts);
              } else {
                tooltip.html("<span>" + d.varx + "<br/> " + d.pct +
                "%</span>" + "<br/>" + d.counts);
              }
          })
        .on('mouseout', function(){ tooltip.style("visibility", "hidden");})
        .on('click', function(d, i) {
          //clear rows if active:
          $(".tabSelect").removeClass("active tabSelect");
          var selected = this;
          if (type === "bp-stacked") {

            for (let j = 1; j <= count; j++) {
              if (j === i + 1)
                $(table.cell(".td" + j).nodes()).addClass("active tabSelect");
            }

          } else {

            d3.selectAll('.bar')
              .attr("class", function(d, i) {
                if (this == selected) {
                  if (data[0].var1 !== undefined) {
                    $(table.cell("#td" + (i + 1)).nodes()).addClass("active tabSelect");
                  } else {
                    $(table.column(i + 1).nodes()).addClass('active tabSelect');
                  }
                  return ("bar selected");
                } else {
                  return ("bar none");
                }
              });

          }
        });
  }

  // for creating buttons in "controls"
  createButton(name, func) {
    let button = d3.select("#control").append("button")
                   .attr("type", "button")
                   .attr("class", "btn btn-primary " + name)
                   .attr("id", "Button" + name)
                   .html("Show " + name)
                   .on("click", func);
  }

  findCounts(data, tableAttr) {
    let cellNo = tableAttr.cellNo;
    let ncol = tableAttr.ncol;
    let nrow = tableAttr.nrow;
    let table = tableAttr.table;
    let colCounts = this.colCounts;
    let countsTab = [];
    let type = this.chartType;

    if (data[0].var1 !== undefined || data[0].Var1 !== undefined) {
      //Finding the sum of countsTab:
      if (type === "bar") {
        for (let i = 1; i <= cellNo / ncol; i++) {
            var tc = document.getElementById('tc' + i);
            countsTab[i-1] = Number(tc.innerHTML);
        }
      } else {
        for (let j = 1; j < ncol; j++) {
            var totalCounts = document.getElementById('counts' + j); //counts for each group
            countsTab[j-1] = Number(totalCounts.innerHTML);
          }
        }

      //global sum variable
      let sum = countsTab.reduce(function(a, b) { return a + b; }, 0);

      this.sum = sum;
      this.countsTab = countsTab;

      //y heading:
      this.insertYHeader();

      if (type === "bar") {
        //Summation row  - should move this to R?
        var lastRow = table.insertRow(nrow); //nrow + 1
        lastRow.setAttribute('class', 'totalRow');

        for (let i = 1; i <= ncol; i ++) {
          var cell = lastRow.insertCell(i-1);
          cell.id = "totalCell" + (i-1);
          cell.setAttribute("class", "totalCell");
          //fill in column totals:
          cell.innerHTML = colCounts[i-1];
        }

        var sumCell = document.getElementById('totalCell' + (ncol-1));
        sumCell.innerHTML = "N = " + sum;
        var totalCell = document.getElementById('totalCell' + (ncol-2));

        this.tableAttr.sumCell = sumCell;
        this.tableAttr.totalCell = totalCell;

      }
      //insert buttons and conversion functions:
      this.createButton("Percentage", this.changeToPercent);
      this.createButton("Count", this.changeToCount);
    }
  }

  reset() {
    d3.selectAll('.bar')
      .attr("class", "bar");
    // reset tables:
    $(".tabSelect").removeClass("active tabSelect");
  }

  init() {
    this.labelRows();
    this.findCounts(this.data, this.tableAttr);

    // now that's done, reformat table:
    let table = new Table(this.chartType);
    table.init();
    this.tbl = table.DT;

    // set up bars and add tooltips:
    let bars = this.screenBars(this.colorMatch);
    let tooltip = this.setTooltip();
    // additional settings for tooltip
    tooltip.style('min-height', '40px')
           .style('visibility', 'hidden');
    this.makeTooltips(bars, this.data);
    // if it's coloured (but not stacked!), enable interactive legend
    if (!this.colorMatch[0]) {
      this.intLegend();
    }

    // reset:
    d3.select("#reset")
      .on("click", this.reset);
    this.plotRegion.addEventListener("click", this.reset, false);
  }

}

/** CLASS FOR UNSTACKED BAR PLOTS
 * This includes 2 way bar plots + 1 way bar plots
 * Coloured and non-coloured!
 */
class UnstackedBar extends Barplot {

  constructor(props) {
    super(props);
  }

  labelRows() {
    let tableAttr = this.setTable();
    let cellNo = tableAttr.cellNo;
    let ncol = tableAttr.ncol;
    let nrow = tableAttr.nrow;
    let td = tableAttr.td;

    //defining table elements
    d3.selectAll('tr')
      .attr('id', function(d, i) { return ('tr' + i) });

    //finding no. of rows, and labelling
    for (let i = 1; i <= cellNo; i++) {
        if (i % ncol === 0) {
            td[i - 1].setAttribute('id', 'tc' + i / ncol);
            td[i - 1].setAttribute('class', 'tc');
        } else if (i % ncol === 1) {
            td[i - 1].setAttribute('id', 'yGroup' + ((i - 1) / ncol + 1));
            td[i - 1].setAttribute('class', 'yGroup');
        } else if (this.data[0].var1 !== undefined) {
            td[i - 1].setAttribute('id', 'td' + (((i - (i % ncol)) / ncol + 1) + ((nrow - 1) * (i % ncol - 2))));
        } else if (i < ncol) {
            td[i - 1].setAttribute('class', 'td' + (i - 1));
        } else {
            td[i - 1].setAttribute('class', 'td' + ((i - 2) % ncol + 1));
        }
      }
  }

  changeToPercent() {

    d3.select(".Count").classed('dark', false);
    d3.select('.Percentage').classed('dark', true);

    let tableAttr = this.tableAttr;
    let cellNo = tableAttr.cellNo;
    let ncol = tableAttr.ncol;
    let nrow = tableAttr.nrow;
    let sumCell = tableAttr.sumCell;
    let totalCell = tableAttr.totalCell;
    let sum = this.sum;
    let countsTab = this.countsTab;

    //for the column sums:
    for (let i = 1; i < ncol-2; i++) {
      var tCol = document.getElementById('totalCell' + i);
      if ((tCol.innerHTML.indexOf('%') == -1) && (tCol.innerHTML.indexOf(".") >=0)) {
        tCol.innerHTML = (Number(tCol.innerHTML)*100).toFixed(2) + '%';
      } else if (tCol.innerHTML.indexOf('%') >= 0) {
        tCol.innerHTML = tCol.innerHTML;
      } else {
        tCol.innerHTML =(Number(tCol.innerHTML)/sum * 100).toFixed(2) + '%';
      }
    }

    //for all other data:
    for (let j = 1; j <= cellNo/ncol; j++) {
      var tr = document.getElementById('tr' + j);
      for (let i = 1; i <= cellNo - 2*(nrow-1); i ++) {
        var td = document.getElementById('td' + i);
        if ((td.innerHTML.indexOf(".") >= 0) && (td.innerHTML.indexOf('%') == -1)) {
          td.innerHTML = (td.innerHTML*100).toFixed(2) + "%";
        } else if (td.innerHTML.indexOf('%') >= 0) {
          td.innerHTML = td.innerHTML;
        } else {
          if(tr.contains(document.getElementById('tc' + j)) && tr.contains(document.getElementById('td' + i))) {
            td.innerHTML = (Number(td.innerHTML)/countsTab[j-1] * 100).toFixed(2) + '%';
            var tc = document.getElementById('tc' + j);
            tc.innerHTML = countsTab[j-1];
          }
        }
      }
    }

    document.getElementsByTagName('th')[(ncol-1)].innerHTML = "Row N";
    totalCell.innerHTML = "100.00%";
    sumCell.innerHTML = "N = " + sum;
  }

  changeToCount() {

    d3.select(".Count").classed('dark', true);
    d3.select('.Percentage').classed('dark', false);

    let tableAttr = this.tableAttr;
    let cellNo = tableAttr.cellNo;
    let ncol = tableAttr.ncol;
    let nrow = tableAttr.nrow;
    let sum = this.sum;
    let countsTab = this.countsTab;
    let sumCell = tableAttr.sumCell;
    let totalCell = tableAttr.totalCell;

    //for the column sums:
    for (let i = 1; i < ncol-2; i++) {
      var tCol = document.getElementById('totalCell' + i);
      if ((tCol.innerHTML.indexOf('%') == -1) && (tCol.innerHTML.indexOf(".") >=0)) {
        tCol.innerHTML = Math.round(Number(tCol.innerHTML)*sum);
      } else if (tCol.innerHTML.indexOf('%') >= 0) {
        tCol.innerHTML = Math.round(Number(tCol.innerHTML.substring(0,tCol.innerHTML.lastIndexOf('%')))/100 * sum);
      } else {
        tCol.innerHTML = tCol.innerHTML;
      }
    }

  //for all other data:
  for (let j = 1; j <= cellNo/ncol; j ++) {
    var tr = document.getElementById('tr' + j);
    for(let i = 1; i <= cellNo - 2*(nrow-1); i++) {
  if(tr.contains(document.getElementById('tc' + j)) && tr.contains(document.getElementById('td' + i))) {
        var td = document.getElementById('td' + i);
        var tc = document.getElementById('tc' + j);
        if (td.innerHTML.indexOf('%') >= 0){
        td.innerHTML = Math.round(Number(td.innerHTML.substring(0,td.innerHTML.lastIndexOf('%')))/100 * countsTab[j-1]);
        tc.innerHTML = (countsTab[j-1]/sum*100).toFixed(2) + "%";
      } else if ((td.innerHTML.indexOf(".") >= 0) && (td.innerHTML.indexOf('%') == -1)){
        td.innerHTML = Math.round(Number(td.innerHTML) * countsTab[j-1]);
        tc.innerHTML = (countsTab[j-1]/sum*100).toFixed(2) + "%";
      } else {
        td.innerHTML = td.innerHTML;
        tc.innerHTML = tc.innerHTML;
      }
        }
      }
    }
    document.getElementsByTagName('th')[(ncol-1)].innerHTML = "Row N %";
    totalCell.innerHTML = "N = " + sum;
    sumCell.innerHTML = "100.00%";
  }

  //For initializing legend interactions
  // one way colored plots and two-way bar plots only
  intLegend() {
    var legendLayout = document.getElementById('inz-leg-layout.1');
    if (!legendLayout) return;

    var data = this.data,
        count = this.count + 1,
        table = this.tbl,
        nrow = this.tableAttr.nrow,
        // groups in 2nd variable (for 2 way tables)
        group = (data[0].var1 !== undefined) ? this.group + 1 : count;

    function subset(i) {
      let j = i + 1;
      $(".tabSelect").removeClass("active tabSelect");
      d3.selectAll('.bar')
        .attr("class", function(d, i) {
          let ind = i + 1;
          if ((ind == j || (ind % (group - 1)) == j || (ind % (group - 1)) == 0 && j == (group - 1))) {
            if(data[0].var1 !== undefined) { // for 2-way tables
              $(table.row((ind - 1) % (nrow - 1)).nodes()).addClass('active tabSelect');
            } else {
              $(table.column(j).nodes()).addClass('active tabSelect');
            }
            return("bar selected");
          } else {
            $(table.row((ind - 1) % (nrow - 1)).nodes()).removeClass('active tabSelect');
            return("bar none");
          }
      });
    }

    // set up legend interaction
    let legend = new Legend(this);
    legend.addHandlers(subset);
  }

}

/** CLASS FOR STACKED BAR PLOTS
 * The reason for having separate classes is because the nature of stacking
 * is reversed in R. (i.e. bars are created from right to left, rather than
 * from left to right...)
 */
class StackedBar extends Barplot {

  constructor(props) {
    super(props);
  }

  labelRows() {

    let tableAttr = this.setTable();
    let cellNo = tableAttr.cellNo;
    let ncol = tableAttr.ncol;
    let nrow = tableAttr.nrow;
    let tr = tableAttr.tr;
    let td = tableAttr.td;

      // labelling rows:
      for (let i = 1; i < nrow; i ++) {
        // last two rows are the rows containing totals and counts
        if(i === nrow - 2) {
          tr[i].setAttribute('class', 'tc');
        } else if (i === nrow - 1) {
          tr[i].setAttribute('class', 'countRow');
        } else {
          tr[i].setAttribute('class', 'row' + i);
        }
      };

      //finding no. of rows, and labelling
      for (let j = 1; j < ncol; j++) {
        for (let i = 1; i <= cellNo; i ++) {
          if (i % ncol === 1){
            td[i-1].setAttribute('id', 'yGroup' + ((i-1)/ncol + 1));
            td[i-1].setAttribute('class', 'yGroup');
          } else if (document.getElementsByClassName('countRow')[0].contains(td[i-1])){
            td[i-1].setAttribute('id', 'counts' + ((i-1)%ncol));
            td[i-1].innerHTML = Number(td[i-1].innerHTML);
          } else if (document.getElementsByClassName('tc')[0].contains(td[i-1])) {
            td[i-1].setAttribute('id', 'tc' +((i-1)%ncol));
            td[i-1].setAttribute('class', 'tc');
          } else {
            td[i-1].setAttribute('id',  'td' + i);
            td[i-1].setAttribute('class', 'td' + chart.order[i-Math.ceil(i/ncol)-1]);
          }
        }
      };
  }

  changeToPercent() {

    d3.select(".Count").classed('dark', false);
    d3.select('.Percentage').classed('dark', true);

    let tableAttr = this.tableAttr;
    let cellNo = tableAttr.cellNo;
    let ncol = tableAttr.ncol;
    let nrow = tableAttr.nrow;
    let sum = this.sum;
    let countsTab = this.countsTab;

    for (var i = 1; i <= cellNo; i++) {
      var td = document.getElementById('td' + i);
      var total = document.getElementById('tc' + ((i-1) % ncol));
      var countsCol = document.getElementById('counts' + ((i-1) % ncol));
    if (td !== null) {
      if ((td.innerHTML.indexOf(".") >= 0) && (td.innerHTML.indexOf('%') == -1)) { // change proportion to percentages
        td.innerHTML = (td.innerHTML*100).toFixed(2) + "%";
        total.innerHTML = "100.00%"; // this is a bit iffy. Fixed at 100.
        countsCol.innerHTML = countsCol.innerHTML;
      } else if (td.innerHTML.indexOf('%') >= 0) { // remain as percentages
        td.innerHTML = td.innerHTML;
        total.innerHTML = total.innerHTML;
        countsCol.innerHTML = countsCol.innerHTML;
      } else { // change counts to percentages
        td.innerHTML = (Number(td.innerHTML)/countsTab[((i-1)%ncol)-1]*100).toFixed(2) + "%";
        total.innerHTML = "100.00%";
        countsCol.innerHTML = countsTab[((i-1)%ncol)-1];
      }
        document.getElementById('yGroup' + (nrow - 1)).innerHTML = "Col N"; // change from 'Total %' to 'Col N'
      }
    }

  }

  changeToCount() {

    d3.select(".Count").classed('dark', true);
    d3.select('.Percentage').classed('dark', false);

    let tableAttr = this.tableAttr;
    let cellNo = tableAttr.cellNo;
    let ncol = tableAttr.ncol;
    let nrow = tableAttr.nrow;
    let sum = this.sum;
    let countsTab = this.countsTab;

    for(let i = 1; i <= cellNo; i++) {
        var td = document.getElementById('td' + i);
        var total = document.getElementById('tc' + ((i-1)%ncol)); // by columns
        var countsCol = document.getElementById('counts' + ((i-1)%ncol));
        if (td !== null && total !== undefined) {
        if (td.innerHTML.indexOf('%') >= 0) { // convert percentage to counts
        td.innerHTML = Math.round(Number(td.innerHTML.substring(0,td.innerHTML.lastIndexOf('%')))/100 * countsTab[((i-1)%ncol)-1]);
        countsCol.innerHTML = (countsTab[((i-1)%ncol)-1]/sum*100).toFixed(2) + "%";
        total.innerHTML = Math.round(countsTab[((i-1)%ncol)-1]);
      } else if ((td.innerHTML.indexOf(".") >= 0) && (td.innerHTML.indexOf('%') >= -1)){ //converts proportions to counts
        td.innerHTML = Math.round(Number(td.innerHTML) * countsTab[((i-1)%ncol)-1]);
        countsCol.innerHTML = (countsTab[((i-1)%ncol)-1]/sum*100).toFixed(2) + "%";
        total.innerHTML = Math.round(countsTab[((i-1)%ncol)-1]);
      } else { // remain as counts (if already converted to counts)
        td.innerHTML = td.innerHTML;
        total.innerHTML = total.innerHTML;
      }
    }
  }
    document.getElementById('yGroup' + (nrow - 1)).innerHTML = "Total %";
  }

} </script>
  </body>
</html>
